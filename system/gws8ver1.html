<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocord - ê°¤ë£©ì‹œ ì›Œì¹˜8 ì‹œìŠ¤í…œ ìƒì„¸ í˜ì´ì§€</title>
    <meta name="theme-color" content="#5865F2">
    <style>
        @font-face { font-family: 'Daeojamjil'; src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302_01@1.0/TheJamsil3Regular.woff2') format('woff2'); font-weight: 400; font-display: swap; }
        @font-face { font-family: 'Daeojamjil'; src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302_01@1.0/TheJamsil5Bold.woff2') format('woff2'); font-weight: 700; font-display: swap; }
        @font-face { font-family: 'Daeojamjil'; src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302_01@1.0/TheJamsil6ExtraBold.woff2') format('woff2'); font-weight: 800; font-display: swap; }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Daeojamjil', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: #ffffff; color: #1a1a1a; padding-top: 60px; line-height: 1.6; }
        a { text-decoration: none; color: inherit; }
        button { border: none; background: none; cursor: pointer; }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        header { position: fixed; top: 0; width: 100%; height: 60px; padding: 0 40px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; backdrop-filter: blur(15px); background: rgba(255, 255, 255, 0.85); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .logo-container svg { height: 24px; width: auto; display: block; cursor: pointer; }
        
        .header-right { display: flex; align-items: center; gap: 20px; }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { font-size: 0.95rem; font-weight: 500; transition: color 0.3s; }
        .nav-links a:hover { color: #5865F2; }

        .login-trigger-btn { background: #1a1a1a; color: #fff; padding: 8px 20px; border-radius: 50px; font-size: 0.85rem; font-weight: 700; transition: 0.3s; display: flex; align-items: center; gap: 8px; max-width: 150px; }
        .login-trigger-btn:hover { background: #333; transform: translateY(-2px); }
        .profile-name { display: inline-block; max-width: 80px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; }
        .user-avatar { width: 24px; height: 24px; border-radius: 50%; display: none; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.show { opacity: 1; }
        .login-modal { background: #fff; width: 340px; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transform: scale(0.8); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; }
        .modal-overlay.show .login-modal { transform: scale(1); }
        .modal-close { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; color: #999; cursor: pointer; }
        .modal-title { font-size: 1.5rem; font-weight: 800; margin-bottom: 25px; text-align: center; }
        .input-group { margin-bottom: 15px; }
        .input-group input { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 10px; font-size: 0.95rem; outline: none; transition: 0.3s; background: #f9f9f9; }
        .input-group input:focus { border-color: #5865F2; background: #fff; }
        .btn-login-submit { width: 100%; padding: 12px; background: #1a1a1a; color: #fff; border-radius: 50px; font-weight: 700; font-size: 1rem; margin-bottom: 20px; transition: 0.2s; }
        .btn-login-submit:hover { background: #333; }
        .social-divider { text-align: center; font-size: 0.8rem; color: #aaa; margin-bottom: 20px; position: relative; }
        .social-divider::before, .social-divider::after { content: ""; position: absolute; top: 50%; width: 30%; height: 1px; background: #eee; }
        .social-divider::before { left: 0; }
        .social-divider::after { right: 0; }
        .btn-discord-modal { width: 100%; padding: 12px; background: #5865F2; color: #fff; border-radius: 12px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.2s; }
        .btn-discord-modal:hover { background: #4752c4; }

        /* ì»¨í…ì¸  ì˜ì—­ */
        .content-container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; min-height: 80vh; }
        
        /* ìƒì„¸ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
        .detail-view { display: flex; gap: 40px; margin-bottom: 60px; align-items: stretch; }
        .detail-image-section { flex: 1; max-width: 550px; margin: 0 auto; }
        .detail-main-img { width: 100%; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); object-fit: cover; aspect-ratio: 16/9; background: #f0f0f0; }
        .detail-info-section { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .detail-title { font-size: 2.5rem; font-weight: 800; margin-bottom: 20px; line-height: 1.2; color: #1a1a1a; }
        .detail-desc { font-size: 1.1rem; color: #555; line-height: 1.8; white-space: pre-wrap; margin-bottom: 30px; }
        .btn-download-detail { width: 100%; padding: 16px; background: #1a1a1a; color: #fff; border-radius: 12px; font-weight: 700; text-align: center; transition: 0.2s; font-size: 1.1rem; margin-top: auto; }
        .btn-download-detail:hover { background: #333; transform: translateY(-2px); }

        .tos-container { width: 100%; margin-top: 40px; text-align: center; }
        .tos-img { max-width: 900px; width: 100%; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }

        /* ë¦¬ë·° ë° í‰ì  ìŠ¤íƒ€ì¼ */
        .review-section { margin-top: 60px; border-top: 1px solid #eee; padding-top: 40px; }
        .review-header { font-size: 1.5rem; font-weight: 800; margin-bottom: 20px; }
        .review-list { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; max-height: 500px; overflow-y: auto; padding-right: 5px; }
        .review-list::-webkit-scrollbar { width: 6px; }
        .review-list::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
        .review-list::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
        .review-list::-webkit-scrollbar-thumb:hover { background: #bbb; }

        .review-card { background: #fff; border: 1px solid #eee; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.02); position: relative; }
        .review-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .review-profile-area { display: flex; align-items: center; gap: 12px; }
        .review-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; background: #eee; }
        .review-user-text { display: flex; flex-direction: column; line-height: 1.2; }
        .review-username { font-weight: 700; font-size: 1rem; color: #1a1a1a; }
        .review-userid { font-size: 0.8rem; color: #888; }
        .review-stars { color: #FFD700; letter-spacing: -2px; font-size: 1.1rem; }
        .review-content { color: #444; font-size: 0.95rem; line-height: 1.5; white-space: pre-wrap; margin-top: 5px; }
        .review-actions { display: flex; gap: 8px; font-size: 0.8rem; color: #999; margin-left: auto; }
        .review-action-btn { cursor: pointer; text-decoration: underline; }
        .review-action-btn:hover { color: #5865F2; }

        .review-input-container { background: #f9f9f9; padding: 25px; border-radius: 15px; margin-bottom: 30px; }
        .review-input-container.disabled { opacity: 0.6; pointer-events: none; position: relative; }
        .review-input-container.disabled::after { content: "ì´ë¯¸ ë¦¬ë·°ë¥¼ ì‘ì„±í•˜ì…¨ìŠµë‹ˆë‹¤."; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 800; color: #333; background: rgba(255,255,255,0.9); padding: 10px 20px; border-radius: 8px; }

        .star-rating-area { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .star-rating-area span { font-weight: 700; color: #555; }
        .stars { display: flex; gap: 5px; cursor: pointer; }
        .star { font-size: 1.5rem; color: #ddd; transition: color 0.2s; }
        .star.active { color: #FFD700; }
        .review-textarea { width: 100%; height: 80px; padding: 15px; border: 1px solid #ddd; border-radius: 10px; resize: none; font-size: 0.95rem; outline: none; margin-bottom: 15px; }
        .review-textarea:focus { border-color: #5865F2; }
        
        .btn-review-submit { background: #5865F2; color: white; padding: 10px 25px; border-radius: 8px; font-weight: 700; font-size: 0.95rem; float: right; transition: 0.2s; }
        .btn-review-submit:hover { background: #4752c4; }
        .btn-review-cancel { background: #aaa; color: white; padding: 10px 25px; border-radius: 8px; font-weight: 700; font-size: 0.95rem; float: right; margin-right: 10px; transition: 0.2s; display: none; }
        .clearfix::after { content: ""; clear: both; display: table; }

        .spinner-container { display: flex; justify-content: center; padding: 50px 0; width: 100%; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #5865F2; border-radius: 50%; animation: spin 1s linear infinite; }
        .btn-loading-spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* í–„ë²„ê±° ë²„íŠ¼ ë° ëª¨ë°”ì¼ ë©”ë‰´ */
        .hamburger-btn { display: none; width: 24px; height: 24px; position: relative; z-index: 1100; }
        .hamburger-btn span { display: block; width: 100%; height: 2px; background: #1a1a1a; position: absolute; left: 0; transition: 0.3s; }
        .hamburger-btn span:nth-child(1) { top: 4px; }
        .hamburger-btn span:nth-child(2) { top: 11px; }
        .hamburger-btn span:nth-child(3) { top: 18px; }
        .hamburger-btn.active span:nth-child(1) { top: 11px; transform: rotate(45deg); }
        .hamburger-btn.active span:nth-child(2) { opacity: 0; }
        .hamburger-btn.active span:nth-child(3) { top: 11px; transform: rotate(-45deg); }

        .mobile-menu { position: fixed; top: 60px; left: 0; width: 100%; background: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); padding: 20px 0; display: flex; flex-direction: column; align-items: center; gap: 15px; transform: translateY(-150%); transition: transform 0.3s ease-in-out; z-index: 999; }
        .mobile-menu.active { transform: translateY(0); }
        .mobile-menu a { font-size: 1.1rem; font-weight: 700; width: 100%; text-align: center; padding: 10px 0; }

        .user-dropdown { position: absolute; top: 60px; right: 40px; width: 260px; background: #fff; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); padding: 20px; display: none; flex-direction: column; gap: 15px; border: 1px solid #eee; z-index: 1002; }
        .user-dropdown.active { display: flex; }
        .dropdown-profile-header { display: flex; align-items: center; gap: 12px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .dropdown-avatar-large { width: 50px; height: 50px; border-radius: 50%; background: #eee; object-fit: cover; }
        .dropdown-text-info { display: flex; flex-direction: column; overflow: hidden; }
        .dropdown-name { font-weight: 800; font-size: 1rem; color: #1a1a1a; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .dropdown-id { font-size: 0.8rem; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .dropdown-stats { font-size: 0.9rem; color: #333; font-weight: 600; }
        .dropdown-stats span { color: #5865F2; }
        .cart-btn { width: 100%; padding: 10px; background: #f0f0f0; color: #333; border-radius: 8px; font-weight: 700; font-size: 0.9rem; text-align: center; transition: 0.2s; }
        .cart-btn:hover { background: #e0e0e0; }
        .logout-btn { width: 100%; padding: 8px; background: #ff4757; color: #fff; border-radius: 8px; font-weight: 700; font-size: 0.85rem; text-align: center; }
        .logout-btn:hover { background: #e84118; }
        .auto-login-wrapper { display: flex; align-items: center; gap: 8px; margin-bottom: 25px; cursor: pointer; user-select: none; font-size: 0.9rem; color: #666; }
        .checkbox-icon { width: 20px; height: 20px; border: 2px solid #ddd; border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: 0.2s; background: #fff; }
        .checkbox-icon svg { width: 12px; height: 12px; fill: none; stroke: #fff; stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; display: none; }
        .auto-login-wrapper input[type="checkbox"] { display: none; }
        .auto-login-wrapper input[type="checkbox"]:checked + .checkbox-icon { background: #5865F2; border-color: #5865F2; }
        .auto-login-wrapper input[type="checkbox"]:checked + .checkbox-icon svg { display: block; }

        footer { padding: 40px; font-size: 0.75rem; color: #666; text-align: center; background: #f9f9f9; border-top: 1px solid #eee; margin-top: 60px; }

        /* ë¡œë”© ì˜¤ë²„ë ˆì´ (ìµœìƒë‹¨ ë°°ì¹˜) */
        .redirect-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 1);
            z-index: 9999;
            display: none; justify-content: center; align-items: center; flex-direction: column;
        }
        .redirect-overlay.active { display: flex; }
        .loading-spinner-large {
            width: 50px; height: 50px; border: 5px solid #f3f3f3;
            border-top: 5px solid #5865F2; border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 20px;
        }

        @media (max-width: 900px) { 
            .detail-view { flex-direction: column; } 
            .detail-image-section, .detail-info-section { max-width: 100%; }
            .detail-main-img { aspect-ratio: auto; }
        }
        @media (max-width: 768px) {
            header { height: 55px; padding: 0 20px; }
            .nav-links { display: none; }
            .logo-container svg { height: 20px; }
            .hamburger-btn { display: block; }
            .user-dropdown { right: 20px; width: 240px; }
            .mobile-menu { top: 55px; border-radius: 0 0 20px 20px; }
        }
    </style>
</head>
<body>

<div class="redirect-overlay" id="redirectOverlay">
    <div class="loading-spinner-large"></div>
    <h2 style="font-weight: 700;">ë¡œê·¸ì¸ ì •ë³´ í™•ì¸ ì¤‘...</h2>
</div>

<header>
    <div class="logo-container" onclick="location.href='index.html'">
        <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 454.000000 95.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,95.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
                <path d="M110 725 l0 -75 254 0 254 0 43 -45 c24 -25 48 -45 54 -45 6 0 34 24 63 53 l52 53 -68 67 -68 67 -292 0 -292 0 0 -75z"/>
                <path d="M940 513 l1 -178 82 -92 81 -93 218 0 218 0 0 264 c0 231 -2 265 -16 270 -9 3 -144 6 -300 6 l-284 0 0 -177z m430 -88 l0 -175 -74 0 -73 0 -57 67 -56 67 0 102 c0 55 3 104 7 107 3 4 62 7 130 7 l123 0 0 -175z"/>
                <path d="M2350 516 l0 -175 83 -95 82 -94 218 -1 217 -1 -2 268 -3 267 -297 3 -298 2 0 -174z m438 -93 l2 -173 -77 0 -78 0 -57 71 -58 71 0 97 c0 54 3 101 7 105 4 3 63 5 132 4 l126 -3 3 -172z"/>
                <path d="M1640 410 l0 -270 263 0 263 0 43 44 c41 42 42 43 19 50 -13 3 -110 6 -215 6 l-193 0 0 175 0 175 178 0 178 0 25 28 c62 68 85 62 -255 62 l-306 0 0 -270z"/>
                <path d="M3080 615 l0 -65 213 0 213 0 34 -35 c19 -19 39 -35 45 -35 6 0 29 18 50 40 l39 40 -59 60 -59 60 -238 0 -238 0 0 -65z"/>
                <path d="M3780 410 l0 -270 224 0 224 0 70 113 c109 174 108 145 15 294 l-80 128 -226 3 -227 2 0 -270z m382 93 c62 -99 63 -84 -9 -194 l-44 -69 -79 0 -80 0 0 175 0 175 78 0 79 0 55 -87z"/>
                <path d="M510 295 l135 -135 110 0 110 0 -135 135 -135 135 -110 0 -110 0 135 -135z"/>
                <path d="M3355 318 c28 -29 75 -79 105 -111 l54 -57 96 0 95 0 -110 110 -110 110 -89 0 -90 0 49 -52z"/>
                <path d="M110 255 l0 -95 95 0 95 0 0 95 0 95 -95 0 -95 0 0 -95z"/>
                <path d="M3080 230 l0 -80 80 0 81 0 -3 78 -3 77 -77 3 -78 3 0 -81z"/>
            </g>
        </svg>
    </div>
    <div class="header-right">
        <nav class="nav-links">
            <a href="https://rocorddev.kro.kr/model.html">ëª¨ë¸</a>
            <a href="https://rocorddev.kro.kr/system.html" style="color:#5865F2">ì‹œìŠ¤í…œ</a>
            <a href="https://rocorddev.kro.kr/car.html">ì°¨ëŸ‰</a>
            <a href="https://rocorddev.kro.kr/shirt.html">ë³µì¥</a>
        </nav>

        <button id="headerLoginBtn" class="login-trigger-btn" onclick="openLoginModal()">
            <img id="userAvatar" class="user-avatar" src="" alt="">
            <span id="loginBtnText" class="profile-name">ë¡œê·¸ì¸</span>
        </button>

        <button class="hamburger-btn" onclick="toggleMobileMenu()">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
</header>

<div class="mobile-menu" id="mobileMenu">
    <a href="https://rocorddev.kro.kr/model.html">ëª¨ë¸</a>
    <a href="https://rocorddev.kro.kr/system.html">ì‹œìŠ¤í…œ</a>
    <a href="https://rocorddev.kro.kr/car.html">ì°¨ëŸ‰</a>
    <a href="https://rocorddev.kro.kr/shirt.html">ë³µì¥</a>
</div>

<div class="user-dropdown" id="userDropdown">
    <div class="dropdown-profile-header">
        <img id="dropdownAvatar" class="dropdown-avatar-large" src="" alt="Profile">
        <div class="dropdown-text-info">
            <div id="dropdownName" class="dropdown-name">ì‚¬ìš©ì</div>
            <div id="dropdownId" class="dropdown-id">@username</div>
        </div>
    </div>
    <div class="dropdown-stats">
        ë‚´ê°€ ë‹¤ìš´ë¡œë“œí•œ ëª¨ë¸: <span id="downloadCount">0</span>ê°œ
    </div>
    <button class="cart-btn" onclick="alert('ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥ì€ ì¶”í›„ ì—…ë°ì´íŠ¸ ì˜ˆì •ì…ë‹ˆë‹¤.')">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</button>
    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
</div>

<div class="modal-overlay" id="loginModalOverlay">
    <div class="login-modal">
        <span class="modal-close" onclick="closeLoginModal()">&times;</span>
        <h2 class="modal-title">ë¡œê·¸ì¸</h2>
        <div class="input-group">
            <input type="text" id="loginId" placeholder="ì•„ì´ë””">
        </div>
        <div class="input-group">
            <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
        </div>
        <label class="auto-login-wrapper">
            <input type="checkbox">
            <span class="checkbox-icon">
                <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </span>
            ìë™ë¡œê·¸ì¸
        </label>
        <button class="btn-login-submit" onclick="handleLoginSubmit()">ë¡œê·¸ì¸</button>
        <div class="social-divider">ì†Œì…œ ë¡œê·¸ì¸</div>
        <button class="btn-discord-modal" onclick="loginWithDiscord()">
            <svg width="24" height="24" viewBox="0 0 127 96" fill="white">
                <path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.11,77.11,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.89,105.89,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
            </svg>
            Discordë¡œ ë¡œê·¸ì¸
        </button>
    </div>
</div>

<div class="content-container">
    <div id="detailContainer">
        <div class="spinner-container">
            <div class="spinner"></div>
        </div>
    </div>

    <div class="review-section">
        <h3 class="review-header">ìƒí’ˆí‰ ë° í‰ì </h3>
        
        <div id="reviewList" class="review-list">
            </div>

        <div class="review-input-container" id="reviewInputContainer">
            <div class="star-rating-area">
                <span>ë³„ì :</span>
                <div class="stars" id="starRating">
                    <span class="star" data-value="1">â˜…</span>
                    <span class="star" data-value="2">â˜…</span>
                    <span class="star" data-value="3">â˜…</span>
                    <span class="star" data-value="4">â˜…</span>
                    <span class="star" data-value="5">â˜…</span>
                </div>
            </div>
            <textarea id="reviewContent" class="review-textarea" placeholder="ì´ ëª¨ë¸ì— ëŒ€í•œ ì†”ì§í•œ í‰ê°€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”."></textarea>
            <div class="clearfix">
                <button class="btn-review-submit" id="btnSubmitReview" onclick="submitReview()">ë“±ë¡í•˜ê¸°</button>
                <button class="btn-review-cancel" id="btnCancelEdit" onclick="cancelEditMode()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>
</div>

<footer>
    Â© 2025-2026 Rocord Deploy. All Rights Reserved.
</footer>

<script>
    const TARGET_MODEL_NAME = "ê°¤ë£©ì‹œ ì›Œì¹˜8 ì‹œìŠ¤í…œ";
    const SITE_UNIQUE_ID = "GW8_SYS_PAGE_001"; 

    const CLIENT_ID = '1460856182716502036';
    const BACKEND_URL = 'https://rocorddev.pythonanywhere.com';

    let isLoggedIn = false;
    let currentUserToken = null;
    let currentUserId = null; // ë¡œê·¸ì¸í•œ ìœ ì €ì˜ Discord ID
    let currentRating = 0; 
    let isEditMode = false; // ìˆ˜ì • ëª¨ë“œ ì—¬ë¶€

    // ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜: URLì´ë‚˜ ì €ì¥ì†Œì—ì„œ í† í° í™•ì¸ ë° ìë™ ë¡œê·¸ì¸ (í˜ì´ì§€ ë¡œë“œ ì¦‰ì‹œ ì‹¤í–‰)
    (function checkLoginImmediately() {
        const urlHash = window.location.hash.substring(1);
        const urlParams = new URLSearchParams(urlHash);
        const accessTokenInUrl = urlParams.get('access_token');
        const storedToken = localStorage.getItem('discord_token');
        
        // 1. ë””ìŠ¤ì½”ë“œ ë¡œê·¸ì¸ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ ëœ ê²½ìš° (URLì— í† í° ì¡´ì¬)
        if (accessTokenInUrl) {
            document.getElementById('redirectOverlay').classList.add('active'); // ë¡œë”© í™”ë©´ ì¦‰ì‹œ í‘œì‹œ
            localStorage.setItem('discord_token', accessTokenInUrl); // í† í° ì €ì¥
            
            // URL ì •ë¦¬ (í† í° ì •ë³´ ìˆ¨ê¹€)
            history.replaceState(null, null, window.location.pathname);
            
            // ë¡œê·¸ì¸ ì²˜ë¦¬ ì‹œì‘
            loginToBackend(accessTokenInUrl);
        }
        // 2. ì´ë¯¸ ë¡œê·¸ì¸ ëœ ê²½ìš° (ì €ì¥ëœ í† í° ì¡´ì¬)
        else if (storedToken) {
            document.getElementById('redirectOverlay').classList.add('active'); // ë¡œë”© í™”ë©´ ì¦‰ì‹œ í‘œì‹œ
            loginToBackend(storedToken);
        }
    })();

    window.onload = function() {
        // í† í° ì²´í¬ëŠ” IIFEì—ì„œ ë¨¼ì € ìˆ˜í–‰ë˜ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” ë°ì´í„° ë¡œë“œë§Œ ì§„í–‰
        fetchModelDetail();
        fetchReviews();
        
        document.getElementById('loginModalOverlay').addEventListener('click', function(e) {
            if (e.target === this) closeLoginModal();
        });

        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('userDropdown');
            const headerBtn = document.getElementById('headerLoginBtn');
            const hamburger = document.querySelector('.hamburger-btn');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (!dropdown.contains(e.target) && !headerBtn.contains(e.target)) {
                dropdown.classList.remove('active');
            }
            if (!hamburger.contains(e.target) && !mobileMenu.contains(e.target)) {
                mobileMenu.classList.remove('active');
                hamburger.classList.remove('active');
            }
        });

        const stars = document.querySelectorAll('#starRating .star');
        stars.forEach(star => {
            star.addEventListener('click', function() {
                const val = parseInt(this.getAttribute('data-value'));
                currentRating = val;
                updateStarVisuals(val);
            });
        });
    };

    function updateStarVisuals(val) {
        const stars = document.querySelectorAll('#starRating .star');
        stars.forEach(s => {
            if (parseInt(s.getAttribute('data-value')) <= val) {
                s.classList.add('active');
            } else {
                s.classList.remove('active');
            }
        });
    }

    function toggleMobileMenu() {
        const btn = document.querySelector('.hamburger-btn');
        const menu = document.getElementById('mobileMenu');
        btn.classList.toggle('active');
        menu.classList.toggle('active');
    }

    function loginToBackend(token) {
        // ë¡œë”© í™”ë©´ í‘œì‹œ (ì´ë¯¸ ì¼œì ¸ìˆì„ ìˆ˜ ìˆì§€ë§Œ í™•ì‹¤íˆ í•˜ê¸° ìœ„í•´)
        document.getElementById('redirectOverlay').classList.add('active');

        fetch(`${BACKEND_URL}/api/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ access_token: token })
        })
        .then(res => res.json())
        .then(data => {
            if(data.error) throw new Error(data.error);
            currentUserToken = token;
            currentUserId = data.id; // ìœ ì € ID ì €ì¥
            isLoggedIn = true;
            updateUI(data);
            fetchReviews(); // ë¡œê·¸ì¸ í›„ ë‚´ ë¦¬ë·° ìƒíƒœ í™•ì¸ ìœ„í•´ ë‹¤ì‹œ ë¡œë“œ
            closeLoginModal();
        })
        .catch(err => {
            console.error(err);
            localStorage.removeItem('discord_token');
        })
        .finally(() => {
            // í†µì‹  ì™„ë£Œ í›„ ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
            document.getElementById('redirectOverlay').classList.remove('active');
        });
    }

    function updateUI(data) {
        const loginText = document.getElementById('loginBtnText');
        const avatar = document.getElementById('userAvatar');
        const btn = document.getElementById('headerLoginBtn');

        loginText.innerText = data.global_name || data.username;
        avatar.style.display = 'block';
        let avatarUrl = "https://cdn.discordapp.com/embed/avatars/0.png";
        if (data.avatar) {
            avatarUrl = `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png`;
        }
        avatar.src = avatarUrl;
        
        btn.style.background = "transparent"; 
        btn.style.color = "#1a1a1a";
        btn.style.border = "1px solid #ddd";
        
        document.getElementById('dropdownAvatar').src = avatarUrl;
        document.getElementById('dropdownName').innerText = data.global_name || data.username;
        document.getElementById('dropdownId').innerText = '@' + data.username;
        document.getElementById('downloadCount').innerText = data.download_count || 0;
    }

    function openLoginModal() {
        if(isLoggedIn) {
            document.getElementById('userDropdown').classList.toggle('active');
        } else {
            const modal = document.getElementById('loginModalOverlay');
            modal.style.display = 'flex';
            setTimeout(() => { modal.classList.add('show'); }, 10);
        }
    }

    function closeLoginModal() {
        const modal = document.getElementById('loginModalOverlay');
        modal.classList.remove('show');
        setTimeout(() => { modal.style.display = 'none'; }, 300);
    }

    function handleLoginSubmit() {
        const id = document.getElementById('loginId').value;
        const pw = document.getElementById('loginPw').value;
        if(!id || !pw) return alert("ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

        fetch(`${BACKEND_URL}/api/admin/login`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id, pw})
        })
        .then(res=>res.json())
        .then(data => {
            if(data.success) {
                localStorage.setItem('admin_token', data.token);
                window.location.href = 'upload.html';
            } else {
                alert("ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹¤íŒ¨");
            }
        });
    }

    function loginWithDiscord() {
        // [ì¤‘ìš”] í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œ(ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì œì™¸)ë¥¼ ë¦¬ë‹¤ì´ë ‰íŠ¸ URIë¡œ ì‚¬ìš©
        // ì£¼ì˜: ë””ìŠ¤ì½”ë“œ ê°œë°œì í¬í„¸ì˜ Redirects í•­ëª©ì— 'https://rocorddev.kro.kr/gws8ver1.html'ì´ ë“±ë¡ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
        const currentRedirectUri = window.location.origin + window.location.pathname;
        const oauthUrl = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(currentRedirectUri)}&response_type=token&scope=identify`;
        window.location.href = oauthUrl;
    }

    function logout() {
        localStorage.removeItem('discord_token');
        isLoggedIn = false;
        currentUserToken = null;
        currentUserId = null;
        location.reload();
    }

    function fetchModelDetail() {
        fetch(`${BACKEND_URL}/api/models`)
        .then(res => res.json())
        .then(data => {
            const model = data.find(m => m.name === TARGET_MODEL_NAME);
            renderDetail(model);
        })
        .catch(err => {
            console.error(err);
            document.getElementById('detailContainer').innerHTML = '<div style="text-align:center;width:100%">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
        });
    }

    function renderDetail(model) {
        const container = document.getElementById('detailContainer');
        container.innerHTML = ''; 

        if (!model) {
            container.innerHTML = `<div style="text-align:center; width:100%;">"${TARGET_MODEL_NAME}" ëª¨ë¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
            return;
        }

        container.innerHTML = `
            <div class="detail-view">
                <div class="detail-image-section">
                    <img src="${model.image}" alt="${model.name}" class="detail-main-img">
                </div>
                <div class="detail-info-section">
                    <div>
                        <h1 class="detail-title">${model.name}</h1>
                        <p class="detail-desc">${model.desc}</p>
                    </div>
                    <button class="btn-download-detail" onclick="downloadModel(this, '${model.name}')">ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>
            <div class="tos-container">
                <img src="ì´ìš©ê·œì •.png" alt="ì´ìš©ê·œì •" class="tos-img">
            </div>
        `;
    }

    function downloadModel(btnElement, targetId) {
        if (!isLoggedIn) {
            alert("ğŸ”’ ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
            openLoginModal();
            return;
        }
        
        const originalText = btnElement.innerHTML;
        btnElement.innerHTML = '<span class="btn-loading-spinner"></span>';
        btnElement.disabled = true;

        fetch(`${BACKEND_URL}/api/request_download`, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${currentUserToken}` 
            },
            body: JSON.stringify({ target_id: targetId })
        })
        .then(res => res.json())
        .then(data => {
            if(data.url) {
                window.location.href = data.url;
                let countSpan = document.getElementById('downloadCount');
                if(countSpan) countSpan.innerText = parseInt(countSpan.innerText) + 1;
            } else {
                alert("ë§í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        })
        .catch(err => {
            alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        })
        .finally(() => {
            setTimeout(() => {
                btnElement.innerHTML = originalText;
                btnElement.disabled = false;
            }, 2000);
        });
    }

    function fetchReviews() {
        fetch(`${BACKEND_URL}/api/reviews?model_id=${SITE_UNIQUE_ID}`)
        .then(res => res.json())
        .then(data => {
            const list = document.getElementById('reviewList');
            const inputContainer = document.getElementById('reviewInputContainer');
            list.innerHTML = '';
            
            // 1ì¸ 1ë¦¬ë·° ì²´í¬
            let myReviewExists = false;

            if (data.length === 0) {
                list.innerHTML = '<div style="text-align:center;color:#888;padding:20px;">ì•„ì§ ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                data.forEach(review => {
                    // ì•„ë°”íƒ€ ì²˜ë¦¬
                    let avatarUrl = "https://cdn.discordapp.com/embed/avatars/0.png";
                    if (review.avatar) {
                        avatarUrl = `https://cdn.discordapp.com/avatars/${review.user_id}/${review.avatar}.png`;
                    }

                    const card = document.createElement('div');
                    card.className = 'review-card';
                    const starsStr = 'â˜…'.repeat(review.rating);
                    
                    // ë³¸ì¸ ë¦¬ë·° í™•ì¸
                    let actionButtons = '';
                    if (isLoggedIn && review.user_id === currentUserId) {
                        myReviewExists = true;
                        actionButtons = `
                            <div class="review-actions">
                                <span class="review-action-btn" onclick="setEditMode('${review.content}', ${review.rating})">ìˆ˜ì •</span>
                                <span class="review-action-btn" onclick="deleteReview()">ì‚­ì œ</span>
                            </div>
                        `;
                    }

                    card.innerHTML = `
                        <div class="review-card-header">
                            <div class="review-profile-area">
                                <img src="${avatarUrl}" class="review-avatar" alt="Avatar">
                                <div class="review-user-text">
                                    <div class="review-username">${review.username}</div>
                                    <div class="review-userid">@${review.username}</div>
                                </div>
                            </div>
                            ${actionButtons}
                        </div>
                        <div class="review-stars">${starsStr}</div>
                        <div class="review-content">${review.content}</div>
                    `;
                    list.appendChild(card);
                });
            }

            // ë³¸ì¸ ë¦¬ë·°ê°€ ìˆê³  ìˆ˜ì • ëª¨ë“œê°€ ì•„ë‹ˆë©´ ì…ë ¥ì°½ ë¹„í™œì„±í™”
            if (myReviewExists && !isEditMode) {
                inputContainer.classList.add('disabled');
            } else {
                inputContainer.classList.remove('disabled');
            }
        })
        .catch(err => console.error("ë¦¬ë·° ë¡œë“œ ì‹¤íŒ¨:", err));
    }

    function setEditMode(content, rating) {
        isEditMode = true;
        document.getElementById('reviewInputContainer').classList.remove('disabled');
        document.getElementById('reviewContent').value = content;
        currentRating = rating;
        updateStarVisuals(rating);
        
        document.getElementById('btnSubmitReview').innerText = "ìˆ˜ì •í•˜ê¸°";
        document.getElementById('btnCancelEdit').style.display = 'inline-block';
        
        // ì…ë ¥ì°½ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
        document.getElementById('reviewInputContainer').scrollIntoView({ behavior: 'smooth' });
    }

    function cancelEditMode() {
        isEditMode = false;
        document.getElementById('reviewContent').value = '';
        currentRating = 0;
        updateStarVisuals(0);
        document.getElementById('btnSubmitReview').innerText = "ë“±ë¡í•˜ê¸°";
        document.getElementById('btnCancelEdit').style.display = 'none';
        fetchReviews(); // ìƒíƒœ ë¦¬ì…‹
    }

    function submitReview() {
        if (!isLoggedIn) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            openLoginModal();
            return;
        }
        const content = document.getElementById('reviewContent').value;
        if (currentRating === 0) return alert("ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        if (!content.trim()) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        const btn = document.getElementById('btnSubmitReview');
        const originalText = btn.innerText;
        btn.innerHTML = '<span class="btn-loading-spinner"></span>';
        btn.disabled = true;

        // ìˆ˜ì • ëª¨ë“œì¸ ê²½ìš° PUT, ì•„ë‹ˆë©´ POST
        const method = isEditMode ? 'PUT' : 'POST';

        fetch(`${BACKEND_URL}/api/reviews`, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${currentUserToken}`
            },
            body: JSON.stringify({
                model_id: SITE_UNIQUE_ID,
                rating: currentRating,
                content: content
            })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                cancelEditMode(); // ì´ˆê¸°í™” ë° ë¦¬ìŠ¤íŠ¸ ê°±ì‹ 
            } else {
                alert("ì˜¤ë¥˜ ë°œìƒ: " + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        })
        .catch(err => {
            console.error(err);
            alert("ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        })
        .finally(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
        });
    }

    function deleteReview() {
        if (!confirm("ì •ë§ ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        fetch(`${BACKEND_URL}/api/reviews`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${currentUserToken}`
            },
            body: JSON.stringify({
                model_id: SITE_UNIQUE_ID
            })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                isEditMode = false; // í˜¹ì‹œ ìˆ˜ì •ëª¨ë“œì˜€ë‹¤ë©´ í•´ì œ
                cancelEditMode(); // UI ë¦¬ì…‹
            } else {
                alert("ì‚­ì œ ì‹¤íŒ¨: " + data.error);
            }
        })
        .catch(err => alert("ì„œë²„ í†µì‹  ì˜¤ë¥˜"));
    }
</script>

</body>
</html>
